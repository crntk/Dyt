@model List<Dyt.Data.Entities.Content.BlogPost>
@{
    ViewData["Title"] = "Blog Paylaş";
var photoCount = Model.Count(p => string.IsNullOrEmpty(p.Title));
    var articleCount = Model.Count - photoCount;
}

<style>
  :root{ --brand:#4CAF50; --brand-orange:#FF9800 }
  
  /* Hero with green gradient - UYUMLU */
  .blog-hero{
 position:relative;
    overflow:hidden;
    background:
      radial-gradient(1200px 500px at 20% -10%, rgba(76,175,80,.18), transparent),
      radial-gradient(900px 350px at 80% -10%, rgba(255,152,0,.15), transparent);
    padding:48px 0 36px;
  }
  .blog-hero:before{
    content:"";
    position:absolute;
    inset:-20%;
    background:
      radial-gradient(rgba(76,175,80,.15) 1px, transparent 1.5px),
      radial-gradient(rgba(255,152,0,.08) 1px, transparent 1.5px);
    background-size:32px 32px, 64px 64px;
    background-position:0 0, 16px 16px;
    opacity:.4;
    animation:dotMove 25s linear infinite;
  }
  @@keyframes dotMove{from{transform:translate(0,0)}to{transform:translate(32px,32px)}}

  /* Cards */
  .card{
    border-radius:18px;
    border:1px solid rgba(76,175,80,.2);
    box-shadow:0 12px 35px rgba(0,0,0,.08);
    transition:all .3s ease;
  }
  .card:hover{box-shadow:0 18px 50px rgba(76,175,80,.15)}

  .share-card{
 background:linear-gradient(135deg, rgba(76,175,80,.08), rgba(255,152,0,.05));
    border:2px solid rgba(76,175,80,.2);
    border-radius:18px;
    padding:24px;
    transition:all .3s ease;
  }
  .share-card:hover{
    border-color:rgba(76,175,80,.4);
    box-shadow:0 8px 24px rgba(76,175,80,.15);
    transform:translateY(-2px);
  }

  /* Stats Cards */
  .stat-card{
    background:linear-gradient(135deg, rgba(76,175,80,.08), rgba(255,152,0,.05));
    border:2px solid rgba(76,175,80,.2);
    border-radius:16px;
    padding:20px;
    text-align:center;
    transition:all .3s ease;
  }
  .stat-card:hover{
    border-color:#4CAF50;
    box-shadow:0 8px 24px rgba(76,175,80,.15);
    transform:translateY(-2px);
  }
  .stat-number{
    font-size:40px;
    font-weight:800;
    background:linear-gradient(135deg, #4CAF50, #81C784);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    line-height:1;
    margin-bottom:8px;
  }
  .stat-label{
    font-size:14px;
    font-weight:600;
 color:#64748b;
  }
  .stat-icon{
  font-size:32px;
    margin-bottom:12px;
  }

  /* Progress */
  .progress-wrap{
    position:relative;
    height:8px;
    background:rgba(76,175,80,.1);
    border-radius:10px;
    overflow:hidden;
    margin-top:12px;
  }
  .progress-bar{
    position:absolute;
    left:0;
    top:0;
    bottom:0;
    width:0;
    background:linear-gradient(90deg, #4CAF50, #81C784, #FF9800);
    transition:width .3s ease;
  }

  /* Form Controls */
  .form-control:focus{
    border-color:#4CAF50;
    box-shadow:0 0 0 0.2rem rgba(76,175,80,.25);
  }

  /* Buttons */
  .btn-primary{
    background:linear-gradient(135deg, #4CAF50, #81C784);
  border:none;
    font-weight:600;
    padding:10px 24px;
    border-radius:12px;
    transition:all .3s ease;
  }
  .btn-primary:hover{
    background:linear-gradient(135deg, #388E3C, #4CAF50);
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(76,175,80,.3);
  }

  /* Badge */
  .badge{
    background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff;
    padding:6px 12px;
    border-radius:999px;
    font-weight:600;
    font-size:11px;
    box-shadow:0 4px 8px rgba(76,175,80,.2);
  }

  /* Post Card */
  .post-card{
    position:relative;
    border-radius:18px;
    border:2px solid rgba(76,175,80,.2);
    overflow:hidden;
    transition:all .3s ease;
    background:#fff;
    cursor:pointer;
  }
  .post-card:hover{
    border-color:#4CAF50;
    transform:translateY(-4px);
    box-shadow:0 12px 30px rgba(76,175,80,.2);
  }
  .post-card-header{
    display:flex;
  justify-content:space-between;
    align-items:center;
    padding:12px 16px;
    background:linear-gradient(135deg, rgba(76,175,80,.08), rgba(255,152,0,.05));
    border-bottom:1px solid rgba(76,175,80,.1);
  }
  .post-card-body{
    padding:16px;
  }
  .post-title{
    font-weight:700;
    font-size:16px;
    color:#1e293b;
    margin-bottom:8px;
  }
  .post-summary{
    color:#64748b;
 font-size:14px;
 display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }
  .post-type{
    display:inline-flex;
    align-items:center;
    gap:4px;
    font-size:12px;
    font-weight:600;
  }

  /* Lightbox */
  .lb{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    backdrop-filter:blur(4px);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1060;
    animation:fadeIn .3s ease;
  }
  .lb.open{
    display:flex;
  }
  .lb-dialog{
    position:relative;
    background:#fff;
border-radius:24px;
    max-width:min(900px,95vw);
    max-height:90vh;
    width:auto;
    overflow:hidden;
    box-shadow:0 20px 60px rgba(0,0,0,.4);
    animation:slideUp .3s ease;
  }
  .lb-body{
    padding:24px;
    display:flex;
    flex-direction:column;
    align-items:center;
    overflow-y:auto;
    max-height:85vh;
  }
  .lb-img{
    width:100%;
    height:auto;
max-width:100%;
    border-radius:16px;
    margin-bottom:16px;
  }
  .lb-title{
    font-weight:700;
    font-size:24px;
    color:#1e293b;
    margin-bottom:12px;
    text-align:center;
  }
  .lb-text{
    color:#475569;
    white-space:pre-wrap;
    line-height:1.7;
    text-align:center;
    max-width:100%;
  }
  .lb-close{
    position:absolute;
 top:16px;
 right:16px;
    width:40px;
    height:40px;
    border-radius:50%;
    border:none;
    background:rgba(0,0,0,.5);
    color:#fff;
    font-size:24px;
    line-height:1;
    cursor:pointer;
    transition:all .3s ease;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .lb-close:hover{
    background:rgba(0,0,0,.7);
    transform:rotate(90deg);
  }

  /* Toast */
  .toast{
    position:fixed;
    top:24px;
    right:24px;
    background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff;
    padding:16px 24px;
    border-radius:16px;
  font-weight:600;
    box-shadow:0 8px 24px rgba(76,175,80,.4);
    opacity:0;
    transform:translateY(-20px);
    display:none;
    z-index:9999;
    animation:toastShow .3s ease forwards;
  }
  .toast.show{
    display:block;
  }

  @@keyframes fadeIn{
    from{opacity:0}
  to{opacity:1}
  }
  @@keyframes slideUp{
  from{opacity:0;transform:translateY(40px)}
    to{opacity:1;transform:translateY(0)}
  }
  @@keyframes toastShow{
    to{opacity:1;transform:translateY(0)}
  }

  /* Reveal animation */
  [data-reveal]{opacity:0;transform:translateY(30px);transition:opacity .6s ease, transform .6s ease}
  [data-reveal].in{opacity:1;transform:translateY(0)}

  /* Empty State */
  .empty-state{
    text-align:center;
    padding:60px 20px;
    color:#94a3b8;
  }
  .empty-state-icon{
    font-size:64px;
    margin-bottom:16px;
    opacity:.5;
  }
</style>

<!-- Hero -->
<section class="blog-hero">
  <div class="container position-relative" style="z-index:1">
    <div class="text-center" data-reveal>
      <h1 class="display-5 fw-bold mb-3">📝 Blog Yönetimi</h1>
      <p class="lead mb-0">Fotoğraf ve makale paylaşın, içeriklerinizi yönetin</p>
    </div>
  </div>
</section>

<div class="container py-5">
  <!-- Statistics -->
  <div class="row g-4 mb-5" data-reveal>
    <div class="col-md-4">
    <div class="stat-card">
        <div class="stat-icon">📊</div>
        <div class="stat-number">@Model.Count</div>
        <div class="stat-label">Toplam Paylaşım</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
   <div class="stat-icon">📸</div>
   <div class="stat-number">@photoCount</div>
        <div class="stat-label">Görsel Paylaşımı</div>
  </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <div class="stat-icon">📰</div>
   <div class="stat-number">@articleCount</div>
        <div class="stat-label">Makale Paylaşımı</div>
      </div>
    </div>
  </div>

  <!-- Share Forms -->
  <div class="row g-4 mb-5" data-reveal>
    <!-- Photo Share -->
    <div class="col-lg-6">
      <div class="share-card">
      <div class="d-flex align-items-center gap-2 mb-3">
          <span style="font-size:32px;">📸</span>
          <div>
      <h5 class="mb-0 fw-bold">Fotoğraf Paylaş</h5>
 <small class="text-muted">Instagram tarzı görsel paylaşımı</small>
          </div>
   </div>
        <form id="formPhoto" enctype="multipart/form-data">
          @Html.AntiForgeryToken()
          <div class="mb-3">
       <label class="form-label fw-semibold">📷 Görsel Seçin</label>
        <input type="file" name="image" accept="image/*" class="form-control" required />
    </div>
       <div class="mb-3">
        <label class="form-label fw-semibold">💬 Açıklama (opsiyonel)</label>
         <textarea name="caption" rows="3" class="form-control" placeholder="Görsele açıklama ekleyin..." maxlength="500"></textarea>
          </div>
   <button class="btn btn-primary w-100" type="submit">
       <span class="btn-text">✨ Paylaş</span>
    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
       </button>
          <div class="progress-wrap d-none">
   <div class="progress-bar"></div>
      </div>
        </form>
      </div>
    </div>

    <!-- Article Share -->
    <div class="col-lg-6">
  <div class="share-card">
      <div class="d-flex align-items-center gap-2 mb-3">
      <span style="font-size:32px;">📰</span>
          <div>
            <h5 class="mb-0 fw-bold">Makale Paylaş</h5>
      <small class="text-muted">Detaylı blog yazısı oluşturun</small>
 </div>
        </div>
    <form id="formArticle" enctype="multipart/form-data">
       @Html.AntiForgeryToken()
          <div class="mb-3">
     <label class="form-label fw-semibold">📌 Başlık</label>
   <input name="title" class="form-control" placeholder="Makale başlığı" required />
     </div>
          <div class="mb-3">
    <label class="form-label fw-semibold">✨ Kısa Özet</label>
          <input name="summary" class="form-control" placeholder="Kısa açıklama" required />
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">📝 İçerik (Markdown)</label>
      <textarea name="contentMarkdown" rows="4" class="form-control" placeholder="Makale içeriği..." required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">🖼️ Kapak Görseli (opsiyonel)</label>
            <input type="file" name="cover" accept="image/*" class="form-control" />
  </div>
   <button class="btn btn-primary w-100" type="submit">
            <span class="btn-text">🚀 Yayınla</span>
            <span class="spinner-border spinner-border-sm d-none" role="status"></span>
          </button>
   <div class="progress-wrap d-none">
            <div class="progress-bar"></div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Recent Posts -->
  <div data-reveal>
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <h5 class="fw-bold mb-1">📚 Son Paylaşımlar</h5>
  <p class="text-muted small mb-0">Yayınlanan içerikleriniz</p>
      </div>
      @if (Model.Any())
      {
        <div class="d-flex gap-2">
          <span class="badge">@photoCount 📸</span>
      <span class="badge">@articleCount 📰</span>
        </div>
      }
    </div>

    @if (!Model.Any())
    {
   <div class="empty-state">
     <div class="empty-state-icon">📭</div>
     <h5>Henüz paylaşım yok</h5>
        <p class="text-muted">Yukarıdaki formları kullanarak ilk içeriğinizi paylaşın</p>
      </div>
    }
    else
    {
      <div class="row g-4">
        @foreach(var p in Model){
       var isPhoto = string.IsNullOrEmpty(p.Title);
     var cover = p.Media.OrderBy(m=>m.DisplayOrder).FirstOrDefault()?.MediaFile?.Url;
     <div class="col-md-6 col-lg-4">
            <div class="post-card js-admin-post-card h-100" 
         data-id="@p.Id" 
             data-type="@(isPhoto?"photo":"article")" 
    data-img="@cover" 
     data-title="@p.Title" 
   data-summary="@(string.IsNullOrEmpty(p.Summary) ? p.ContentMarkdown : p.Summary)" 
         data-slug="@p.Slug">
        <div class="post-card-header">
         <div class="text-muted small post-type">
    <span>@(isPhoto ? "📸 Görsel" : "📰 Makale")</span>
          </div>
   <div class="text-muted small">
             @((p.PublishDateUtc ?? p.CreatedAtUtc).ToLocalTime().ToString("dd.MM.yyyy HH:mm"))
        </div>
   </div>
          <div class="post-card-body">
  @if(!string.IsNullOrEmpty(p.Title)){
               <div class="post-title">@p.Title</div>
    }
         <div class="post-summary">@(string.IsNullOrEmpty(p.Summary) ? p.ContentMarkdown : p.Summary)</div>
              </div>
         </div>
          </div>
        }
      </div>
    }
  </div>
</div>

<!-- Lightbox -->
<div class="lb" id="adminPostLightbox" aria-hidden="true">
  <div class="lb-dialog" role="dialog" aria-modal="true">
    <button class="lb-close" type="button" aria-label="Kapat">×</button>
    <div class="lb-body">
      <img class="lb-img" alt="Paylaşım görseli" style="display:none" />
      <div class="lb-article" style="display:none; width:100%;">
        <div class="lb-title"></div>
      <div class="lb-text"></div>
        <div class="mt-4 text-center">
          <a target="_blank" class="btn btn-primary lb-view-public" href="#">
            🔗 Sitede Görüntüle
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <span class="toast-text">✅ Başarıyla paylaşıldı!</span>
</div>

@section Scripts{
<script>
(function(){
  // Reveal animation
  const reveals=[...document.querySelectorAll('[data-reveal]')];
  if('IntersectionObserver' in window){
    const io=new IntersectionObserver((entries)=>{
   entries.forEach(en=>{ 
    if(en.isIntersecting){ 
        setTimeout(()=>en.target.classList.add('in'), 100); 
       io.unobserve(en.target); 
        } 
      });
    },{threshold:.1, rootMargin:'0px 0px -50px 0px'});
    reveals.forEach(e=>io.observe(e));
  } else {
 reveals.forEach(e=>e.classList.add('in'));
  }

  function submitWithProgress(form, url){
    const btnText = form.querySelector('.btn-text');
    const spinner = form.querySelector('.spinner-border');
    const submitBtn = form.querySelector('button[type="submit"]');
  
 form.addEventListener('submit', function(e){
      e.preventDefault();
      
      // Button loading state
      btnText.classList.add('d-none');
      spinner.classList.remove('d-none');
      submitBtn.disabled = true;
      
      const fd = new FormData(form);
      const wrap = form.querySelector('.progress-wrap');
      const bar = form.querySelector('.progress-bar');
      wrap.classList.remove('d-none');
      bar.style.width = '0%';

      const xhr = new XMLHttpRequest();
      xhr.open('POST', url);
      xhr.upload.onprogress = function(ev){
        if(ev.lengthComputable){
          const percent = Math.round(ev.loaded / ev.total * 100);
          bar.style.width = percent + '%';
}
      };
      xhr.onreadystatechange = function(){
   if(xhr.readyState === 4){
      btnText.classList.remove('d-none');
          spinner.classList.add('d-none');
          submitBtn.disabled = false;
  
       try{
      const resp = JSON.parse(xhr.responseText||'{}');
    if(resp.ok){
              bar.style.width = '100%';
              showToast('✅ Başarıyla paylaşıldı!');
              setTimeout(()=>{
          window.location.href = resp.redirect || window.location.href;
    }, 1000);
   } else {
              alert('❌ ' + (resp.message || 'Bir hata oluştu'));
    wrap.classList.add('d-none');
      }
          }catch{
         alert('❌ Sunucu hatası oluştu');
        wrap.classList.add('d-none');
    }
        }
      };
      xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');
      xhr.send(fd);
    });
  }

  function showToast(message){
    const t = document.getElementById('toast');
    const textEl = t.querySelector('.toast-text');
    if(textEl) textEl.textContent = message;
    t.classList.add('show');
    setTimeout(()=>{
   t.classList.remove('show');
 }, 3000);
  }

  submitWithProgress(document.getElementById('formPhoto'), '/Admin/BlogAdmin/SharePhoto');
  submitWithProgress(document.getElementById('formArticle'), '/Admin/BlogAdmin/ShareArticle');

  // Lightbox behavior
  const lb = document.getElementById('adminPostLightbox');
  const img = lb.querySelector('.lb-img');
  const articleBox = lb.querySelector('.lb-article');
  const titleEl = lb.querySelector('.lb-title');
  const textEl = lb.querySelector('.lb-text');
  const viewBtn = lb.querySelector('.lb-view-public');

  function openPhoto(src, text){
    articleBox.style.display='none';
    img.style.display='block';
    img.src = src;
    img.alt = text || '';
    lb.classList.add('open');
    document.body.style.overflow='hidden';
  }

  function openArticle(title, text, slug, cover){
    img.style.display='none';
    if(cover){
      img.src = cover;
      img.style.display='block';
 }
    titleEl.textContent = title || '';
    textEl.textContent = text || '';
    viewBtn.href = '/blog/' + slug;
articleBox.style.display='block';
    lb.classList.add('open');
    document.body.style.overflow='hidden';
  }

  function closeLb(){
    lb.classList.remove('open');
    document.body.style.overflow='';
    img.removeAttribute('src');
  }

  lb.addEventListener('click', function(e){
    if(e.target === lb) closeLb();
  });
  lb.querySelector('.lb-close').addEventListener('click', closeLb);
  document.addEventListener('keydown', function(e){
    if(e.key==='Escape') closeLb();
  });

  // Post card click handlers
  document.querySelectorAll('.js-admin-post-card').forEach(card => {
    card.addEventListener('click', function(){
      const type = this.getAttribute('data-type');
      if(type==='photo'){
        openPhoto(
    this.getAttribute('data-img'),
       this.getAttribute('data-summary')
        );
      } else {
        openArticle(
   this.getAttribute('data-title'),
          this.getAttribute('data-summary'),
       this.getAttribute('data-slug'),
          this.getAttribute('data-img')
        );
      }
    });
  });

  // Auto-open when query has open=id
  const openId = '@(ViewBag.OpenPostId ?? "")';
  if(openId){
    const card = document.querySelector('.js-admin-post-card[data-id="' + openId + '"]');
    if(card){
      card.click();
    }
  }
})();
</script>
}
