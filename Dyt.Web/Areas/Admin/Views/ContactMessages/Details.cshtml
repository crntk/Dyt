@model Dyt.Data.Entities.Content.ContactMessage
@{
    ViewData["Title"] = "Mesaj Detayý";
    
    // Telefon numarasýný temizle - sadece rakamlar ve + iþareti
    var cleanPhone = Model.Phone.Replace(" ", "").Replace("(", "").Replace(")", "").Replace("-", "").Replace(".", "");
    
    // WhatsApp için formatla
    var whatsappPhone = cleanPhone.TrimStart('+');
  
    // Türkiye için 90 ile baþlamýyorsa ekle
    if (!whatsappPhone.StartsWith("90"))
    {
     // 0 ile baþlýyorsa kaldýr ve 90 ekle
        if (whatsappPhone.StartsWith("0"))
   {
 whatsappPhone = "90" + whatsappPhone.Substring(1);
        }
        else if (whatsappPhone.Length == 10)
        {
       whatsappPhone = "90" + whatsappPhone;
        }
    }
}

<style>
  :root{ --brand:#4CAF50; --brand-orange:#FF9800 }
  
  /* Hero with green gradient */
  .details-hero{
    position:relative;
    overflow:hidden;
    background:
radial-gradient(1200px 500px at 20% -10%, rgba(76,175,80,.18), transparent),
      radial-gradient(900px 350px at 80% -10%, rgba(255,152,0,.15), transparent);
    padding:48px 0 36px;
  }
  .details-hero:before{
    content:"";
    position:absolute;
    inset:-20%;
    background:
      radial-gradient(rgba(76,175,80,.15) 1px, transparent 1.5px),
      radial-gradient(rgba(255,152,0,.08) 1px, transparent 1.5px);
    background-size:32px 32px, 64px 64px;
    background-position:0 0, 16px 16px;
    opacity:.4;
    animation:dotMove 25s linear infinite;
  }
  @@keyframes dotMove{from{transform:translate(0,0)}to{transform:translate(32px,32px)}}

  /* Cards */
  .card{
    border-radius:18px;
    border:1px solid rgba(76,175,80,.2);
    box-shadow:0 12px 35px rgba(0,0,0,.08);
    transition:all .3s ease;
  }
  .card:hover{box-shadow:0 18px 50px rgba(76,175,80,.15)}

  /* Breadcrumb */
  .breadcrumb{
    background:transparent;
    padding:0;
    margin-bottom:12px;
  }

  .breadcrumb-item a{
    color:#4CAF50;
    text-decoration:none;
    font-weight:600;
  }

  .breadcrumb-item a:hover{
    text-decoration:underline;
  }

  .breadcrumb-item.active{
    color:#666;
  }

  /* Info Row */
  .info-row{
    display:flex;
    padding:16px 0;
    border-bottom:2px dashed rgba(76,175,80,.15);
    gap:16px;
  }

  .info-row:last-child{
    border-bottom:none;
  }

  .info-label{
    font-weight:700;
    color:#666;
    min-width:160px;
 font-size:14px;
  text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .info-value{
    flex:1;
    color:#333;
    font-size:15px;
    font-weight:600;
  }

  .info-value a{
    color:#4CAF50;
    text-decoration:none;
    font-weight:700;
  }

  .info-value a:hover{
    text-decoration:underline;
  }

  /* Message Content Box */
  .message-content-box{
    background:linear-gradient(135deg, rgba(76,175,80,.08), rgba(255,152,0,.05));
    border-left:6px solid #4CAF50;
  padding:24px;
    border-radius:12px;
    white-space:pre-wrap;
    word-wrap:break-word;
    font-size:15px;
    line-height:1.8;
    color:#333;
    box-shadow:0 4px 12px rgba(76,175,80,.1);
  }

  /* Admin Note Box */
  .admin-note-box{
    background:linear-gradient(135deg, rgba(33,150,243,.08), rgba(33,150,243,.05));
    border-left:6px solid #2196F3;
    padding:20px;
    border-radius:12px;
  }

  /* Action Buttons */
  .btn-action{
    padding:12px 20px;
border-radius:10px;
    font-weight:600;
    font-size:14px;
    border:2px solid transparent;
    transition:all .3s ease;
 display:inline-flex;
    align-items:center;
    gap:8px;
    justify-content:center;
    text-decoration:none;
}

  .btn-action:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 16px rgba(0,0,0,.2);
  }

  .btn-action-primary{
    background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff !important;
    border-color:#4CAF50;
  }

  .btn-action-primary:hover{
    background:linear-gradient(135deg, #388E3C, #4CAF50);
    color:#fff !important;
  }

  .btn-action-success{
    background:linear-gradient(135deg, #25D366, #128C7E);
    color:#fff !important;
    border-color:#25D366;
  }

  .btn-action-success:hover{
    background:linear-gradient(135deg, #128C7E, #25D366);
  color:#fff !important;
  }

  /* Card Title */
  .card-title{
    font-size:18px;
    font-weight:700;
    color:#333;
    margin-bottom:20px;
    display:flex;
    align-items:center;
    gap:10px;
    padding-bottom:12px;
    border-bottom:2px solid rgba(76,175,80,.2);
  }

  /* Status Badge */
  .status-badge-item{
    display:flex;
    align-items:center;
 justify-content:space-between;
    padding:16px;
    background:rgba(76,175,80,.05);
    border-radius:12px;
    margin-bottom:12px;
  }

  .status-badge-item:last-child{
    margin-bottom:0;
  }

  .status-badge-label{
    font-weight:700;
    font-size:14px;
    color:#666;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .badge-custom{
    padding:8px 16px;
    border-radius:999px;
    font-weight:700;
    font-size:13px;
    display:inline-flex;
    align-items:center;
    gap:8px;
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .badge-success{
    background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff;
    box-shadow:0 2px 8px rgba(76,175,80,.3);
  }

  .badge-warning{
    background:linear-gradient(135deg, #FF9800, #FFB74D);
    color:#fff;
    box-shadow:0 2px 8px rgba(255,152,0,.3);
  }

  .badge-danger{
    background:linear-gradient(135deg, #ef4444, #f87171);
    color:#fff;
    box-shadow:0 2px 8px rgba(239,68,68,.3);
  }

.badge-kvkk-yes{
    background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff;
    box-shadow:0 2px 8px rgba(76,175,80,.3);
  }

  .badge-kvkk-no{
    background:linear-gradient(135deg, #ef4444, #f87171);
    color:#fff;
    box-shadow:0 2px 8px rgba(239,68,68,.3);
  }

  /* Reveal Animation */
  [data-reveal]{opacity:0;transform:translateY(30px);transition:opacity .6s ease, transform .6s ease}
  [data-reveal].in{opacity:1;transform:translateY(0)}

  /* Sidebar Sticky */
  .sidebar-sticky{
    position:sticky;
    top:20px;
  }

  /* Responsive */
  @@media (max-width: 992px){
 .sidebar-sticky{
      position:relative;
      top:0;
    }

    .info-row{
      flex-direction:column;
      gap:8px;
    }

    .info-label{
      min-width:auto;
    }
  }
</style>

<!-- Hero -->
<section class="details-hero">
  <div class="container position-relative" style="z-index:1">
    <div data-reveal>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
   <li class="breadcrumb-item"><a asp-action="Index">&#128236; Ýletiþim Mesajlarý</a></li>
      <li class="breadcrumb-item active">Mesaj Detayý</li>
        </ol>
      </nav>
      <h1 class="display-6 fw-bold mb-0">&#9993;&#65039; @Model.Subject</h1>
    </div>
  </div>
</section>

<div class="container py-5">
  @if (TempData["SuccessMessage"] is string successMsg)
  {
    <div class="alert alert-success alert-dismissible fade show" role="alert" data-reveal>
      &#9989; @successMsg
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  }

  <div class="row g-4">
    <!-- Main Content -->
    <div class="col-lg-8">
      <!-- Sender Info -->
      <div class="card mb-4" data-reveal>
  <div class="card-body">
    <h5 class="card-title">
            &#128100; Gönderen Bilgileri
          </h5>
 
          <div class="info-row">
        <div class="info-label">&#128100; Ad Soyad:</div>
         <div class="info-value">@Model.Name</div>
          </div>
      
          <div class="info-row">
        <div class="info-label">&#128231; E-posta:</div>
 <div class="info-value">
      <a href="mailto:@Model.Email">@Model.Email</a>
 </div>
     </div>
     
   <div class="info-row">
    <div class="info-label">&#128241; Telefon:</div>
         <div class="info-value">
              <a href="tel:@cleanPhone">@Model.Phone</a>
            </div>
    </div>
   
          <div class="info-row">
    <div class="info-label">&#128221; Konu:</div>
   <div class="info-value">@Model.Subject</div>
  </div>
       
          <div class="info-row">
      <div class="info-label">&#128197; Gönderim:</div>
            <div class="info-value">@Model.CreatedAtUtc.ToString("dd MMMM yyyy, HH:mm")</div>
          </div>
  
  @if (Model.ReadAt.HasValue)
          {
            <div class="info-row">
            <div class="info-label">&#128065;&#65039; Okunma:</div>
     <div class="info-value">@Model.ReadAt.Value.ToString("dd MMMM yyyy, HH:mm")</div>
            </div>
        }

        @if (Model.RepliedAt.HasValue)
          {
    <div class="info-row">
              <div class="info-label">&#9989; Yanýtlanma:</div>
          <div class="info-value">@Model.RepliedAt.Value.ToString("dd MMMM yyyy, HH:mm")</div>
      </div>
          }
 
      <div class="info-row">
          <div class="info-label">&#128274; KVKK Onayý:</div>
            <div class="info-value">
              @if (Model.KvkkConsent)
      {
          <span class="badge-custom badge-kvkk-yes">
              &#9989; Verildi
    </span>
              }
         else
    {
      <span class="badge-custom badge-kvkk-no">
 &#10060; Verilmedi
        </span>
        }
            </div>
          </div>
    </div>
      </div>

      <!-- Message Content -->
      <div class="card mb-4" data-reveal>
        <div class="card-body">
        <h5 class="card-title">
        &#128172; Mesaj Ýçeriði
          </h5>
          <div class="message-content-box">
            @Model.Message
      </div>
        </div>
      </div>

      <!-- Admin Note -->
      <div class="card" data-reveal>
        <div class="card-body">
          <h5 class="card-title">
            &#9998;&#65039; Admin Notu
     </h5>
        <form asp-action="UpdateNote" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />
     <div class="mb-3">
  <textarea name="adminNote" class="form-control" rows="5" 
  placeholder="Bu mesajla ilgili notlarýnýzý buraya yazabilirsiniz..." 
       style="border-radius:12px;border:2px solid rgba(76,175,80,.2);">@Model.AdminNote</textarea>
            </div>
            <button type="submit" class="btn-action btn-action-primary">
     &#128190; Notu Kaydet
</button>
          </form>
    </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <div class="sidebar-sticky">
        <!-- Quick Actions -->
        <div class="card mb-4" data-reveal>
     <div class="card-body">
 <h5 class="card-title">
        &#9889; Hýzlý Eylemler
   </h5>
         
       <div class="d-grid gap-2">
       <a href="mailto:@Model.Email" class="btn-action btn-action-primary" title="E-posta gönder">
         &#128231; E-posta Gönder
   </a>
          
       <a href="tel:@cleanPhone" class="btn-action btn-action-primary" title="Telefon et">
   &#128222; Telefon Et
       </a>
          
          <a href="https://wa.me/@whatsappPhone" 
        target="_blank" 
         rel="noopener noreferrer"
                 class="btn-action btn-action-success"
         title="WhatsApp ile mesaj gönder">
    &#128172; WhatsApp
    </a>
       
   <hr style="margin:16px 0;border-color:rgba(76,175,80,.2);" />
   
    <!-- Toggle Replied -->
              <form asp-action="ToggleReplied" method="post">
        @Html.AntiForgeryToken()
 <input type="hidden" name="id" value="@Model.Id" />
      <button type="submit" class="btn @(Model.IsReplied ? "btn-outline-warning" : "btn-success") w-100 btn-action">
            @if (Model.IsReplied)
            {
            <text>&#128260; Yanýtlanmadý Ýþaretle</text>
   }
           else
    {
     <text>&#9989; Yanýtlandý Ýþaretle</text>
     }
    </button>
          </form>
         
              <hr style="margin:16px 0;border-color:rgba(76,175,80,.2);" />
    
     <!-- Delete -->
   <form asp-action="Delete" method="post" 
           onsubmit="return confirm('Bu mesajý silmek istediðinizden emin misiniz?');">
  @Html.AntiForgeryToken()
     <input type="hidden" name="id" value="@Model.Id" />
          <button type="submit" class="btn btn-outline-danger w-100 btn-action">
      &#128465;&#65039; Mesajý Sil
  </button>
              </form>
         
      <hr style="margin:16px 0;border-color:rgba(76,175,80,.2);" />
        
      <a asp-action="Index" class="btn btn-outline-secondary btn-action">
              &#11013;&#65039; Listeye Dön
     </a>
    </div>
          </div>
     </div>

        <!-- Status Info -->
        <div class="card" data-reveal>
        <div class="card-body">
  <h5 class="card-title">
      &#128202; Durum Bilgisi
          </h5>
    
  <div class="status-badge-item">
     <span class="status-badge-label">Okunma</span>
            <span class="badge-custom @(Model.IsRead ? "badge-success" : "badge-warning")">
        @if (Model.IsRead)
                {
         <text>&#9989; Okundu</text>
        }
else
    {
    <text>&#9200; Okunmadý</text>
        }
</span>
       </div>
            
       <div class="status-badge-item">
           <span class="status-badge-label">Yanýt</span>
       <span class="badge-custom @(Model.IsReplied ? "badge-success" : "badge-danger")">
      @if (Model.IsReplied)
          {
                  <text>&#9989; Yanýtlandý</text>
       }
        else
   {
<text>&#10060; Bekliyor</text>
      }
       </span>
 </div>
        </div>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
<script>
  // Reveal animation
  const reveals=[...document.querySelectorAll('[data-reveal]')];
  if('IntersectionObserver' in window){
    const io=new IntersectionObserver((entries)=>{
      entries.forEach(en=>{ 
        if(en.isIntersecting){ 
   setTimeout(()=>en.target.classList.add('in'), 100); 
        io.unobserve(en.target); 
        } 
      });
    },{threshold:.1, rootMargin:'0px 0px -50px 0px'});
    reveals.forEach(e=>io.observe(e));
  } else {
    reveals.forEach(e=>e.classList.add('in'));
  }
</script>
}
