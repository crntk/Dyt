@model List<Dyt.Data.Entities.Content.ContactMessage>
@{
ViewData["Title"] = "Ýletiþim Mesajlarý";
    var unreadCount = Model.Count(m => !m.IsRead);
    var unrepliedCount = Model.Count(m => !m.IsReplied);
}

<style>
  :root{ --brand:#4CAF50; --brand-orange:#FF9800 }
  
  /* Hero with green gradient */
  .messages-hero{
    position:relative;
    overflow:hidden;
    background:
    radial-gradient(1200px 500px at 20% -10%, rgba(76,175,80,.18), transparent),
  radial-gradient(900px 350px at 80% -10%, rgba(255,152,0,.15), transparent);
    padding:48px 0 36px;
  }
  .messages-hero:before{
    content:"";
    position:absolute;
    inset:-20%;
    background:
      radial-gradient(rgba(76,175,80,.15) 1px, transparent 1.5px),
      radial-gradient(rgba(255,152,0,.08) 1px, transparent 1.5px);
    background-size:32px 32px, 64px 64px;
    background-position:0 0, 16px 16px;
  opacity:.4;
  animation:dotMove 25s linear infinite;
  }
  @@keyframes dotMove{from{transform:translate(0,0)}to{transform:translate(32px,32px)}}

  /* Cards */
  .card{
    border-radius:18px;
    border:1px solid rgba(76,175,80,.2);
    box-shadow:0 12px 35px rgba(0,0,0,.08);
    transition:all .3s ease;
  }
  .card:hover{box-shadow:0 18px 50px rgba(76,175,80,.15)}

  /* Stats Grid */
  .stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:16px;
    margin-bottom:24px;
  }

.stat-card{
    background:linear-gradient(135deg, rgba(76,175,80,.08), rgba(255,152,0,.05));
  border:2px solid rgba(76,175,80,.2);
  border-radius:16px;
    padding:20px;
    text-align:center;
    transition:all .3s ease;
  }

  .stat-card:hover{
    transform:translateY(-4px);
    box-shadow:0 8px 24px rgba(76,175,80,.2);
  }

  .stat-value{
font-size:36px;
    font-weight:800;
    color:#4CAF50;
    line-height:1;
  }

  .stat-label{
 font-size:13px;
  font-weight:600;
    color:#666;
    margin-top:8px;
    text-transform:uppercase;
 letter-spacing:0.5px;
  }

  /* Filter Chips */
  .filter-chips-container{
    background:linear-gradient(135deg, rgba(76,175,80,.08), rgba(255,152,0,.05));
    border-radius:16px;
    padding:20px;
    border:2px solid rgba(76,175,80,.2);
  }

  .filter-chip {
  display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 18px;
 border-radius:999px;
  border:2px solid rgba(76,175,80,.3);
    background:#fff;
    cursor:pointer;
    font-weight:600;
    font-size:14px;
    color:#4CAF50;
    transition:all .3s ease;
  }
  
  .filter-chip:hover, .filter-chip.active {
    background:linear-gradient(135deg, #4CAF50, #81C784);
    border-color:#4CAF50;
  color:#fff;
    transform:translateY(-2px);
    box-shadow:0 6px 16px rgba(76,175,80,.3);
  }

  .filter-chip .badge{
 background:rgba(76,175,80,.2);
    color:#2e7d32;
    padding:4px 10px;
  border-radius:999px;
    font-size:12px;
    font-weight:700;
  }

  .filter-chip.active .badge, .filter-chip:hover .badge{
    background:rgba(255,255,255,.3);
    color:#fff;
  }

  /* Message Card */
  .message-card {
    border:2px solid rgba(76,175,80,.2);
    border-radius:16px;
    background:#fff;
 transition:all .3s ease;
    margin-bottom:16px;
    overflow:hidden;
  }
  
  .message-card:hover {
  transform:translateY(-4px);
    box-shadow:0 12px 30px rgba(76,175,80,.2);
    border-color:#4CAF50;
  }
  
  .message-card.unread {
    border-left:6px solid #4CAF50;
 background:linear-gradient(135deg, rgba(76,175,80,.05), rgba(255,152,0,.02));
  }

  .message-header{
    display:flex;
    justify-content:space-between;
align-items:flex-start;
    padding:20px 20px 0;
    gap:16px;
  }

  .message-title{
    font-size:20px;
    font-weight:700;
    color:#333;
    margin-bottom:8px;
    display:flex;
align-items:center;
    gap:10px;
  }

  .message-sender-info{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:center;
    margin-bottom:12px;
font-size:14px;
  }

  .sender-item{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 12px;
    background:rgba(76,175,80,.08);
    border-radius:999px;
  font-weight:600;
    color:#333;
  }

  .sender-item a{
    color:#4CAF50;
    text-decoration:none;
    font-weight:700;
  }

  .sender-item a:hover{
    text-decoration:underline;
  }

  .message-content{
    padding:0 20px;
    color:#666;
    font-size:15px;
    line-height:1.6;
  margin-bottom:16px;
  }

  .message-meta{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:center;
 padding:0 20px 16px;
  }

  .message-actions{
    padding:16px 20px;
    background:rgba(76,175,80,.05);
    border-top:2px solid rgba(76,175,80,.1);
    display:flex;
    gap:10px;
  }

  /* Badges */
  .badge-custom{
    padding:6px 14px;
    border-radius:999px;
    font-weight:700;
    font-size:12px;
display:inline-flex;
    align-items:center;
  gap:6px;
  text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .badge-unread {
  background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff;
    box-shadow:0 2px 8px rgba(76,175,80,.3);
  }

  .badge-replied {
    background:linear-gradient(135deg, #2196F3, #64B5F6);
    color:#fff;
    box-shadow:0 2px 8px rgba(33,150,243,.3);
  }

  .badge-unreplied {
    background:linear-gradient(135deg, #FF9800, #FFB74D);
    color:#fff;
    box-shadow:0 2px 8px rgba(255,152,0,.3);
  }

  .date-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 12px;
    background:rgba(76,175,80,.1);
  border-radius:999px;
    font-size:13px;
  font-weight:600;
    color:#666;
  }

  /* Action Buttons */
  .btn-action{
    padding:10px 20px;
    border-radius:10px;
    font-weight:600;
    font-size:14px;
    border:2px solid transparent;
    transition:all .3s ease;
display:inline-flex;
    align-items:center;
    gap:8px;
  }

  .btn-action-primary{
    background:linear-gradient(135deg, #4CAF50, #81C784);
    color:#fff;
    border-color:#4CAF50;
  }

  .btn-action-primary:hover{
    background:linear-gradient(135deg, #388E3C, #4CAF50);
    transform:translateY(-2px);
    box-shadow:0 6px 16px rgba(76,175,80,.3);
color:#fff;
  }

  .btn-action-secondary{
  background:#fff;
 color:#4CAF50;
  border-color:rgba(76,175,80,.3);
  }

  .btn-action-secondary:hover{
    background:linear-gradient(135deg, rgba(76,175,80,.1), rgba(255,152,0,.05));
  border-color:#4CAF50;
    transform:translateY(-2px);
    color:#4CAF50;
  }

  /* Empty State */
  .empty-state{
  text-align:center;
  padding:60px 20px;
  }

  .empty-state-icon{
    font-size:80px;
    margin-bottom:20px;
    opacity:.5;
  }

  .empty-state-title{
    font-size:24px;
    font-weight:700;
    color:#333;
    margin-bottom:12px;
  }

  .empty-state-text{
    font-size:16px;
    color:#666;
  }

  /* Reveal Animation */
  [data-reveal]{opacity:0;transform:translateY(30px);transition:opacity .6s ease, transform .6s ease}
  [data-reveal].in{opacity:1;transform:translateY(0)}

  /* Responsive */
  @@media (max-width: 768px){
    .message-header{
      flex-direction:column;
    }
    
  .message-actions{
      flex-direction:column;
    }
    
    .btn-action{
    width:100%;
      justify-content:center;
  }

  .filter-chips-container{
    padding:16px;
    }

.filter-chip{
  font-size:12px;
      padding:8px 14px;
    }
  }
</style>

<!-- Hero -->
<section class="messages-hero">
  <div class="container position-relative" style="z-index:1">
    <div class="text-center" data-reveal>
      <h1 class="display-5 fw-bold mb-3">&#128236; Ýletiþim Mesajlarý</h1>
      <p class="lead mb-0">Siteden gelen mesajlarý görüntüleyin ve yönetin</p>
  </div>
  </div>
</section>

<div class="container py-5">
  @if (TempData["SuccessMessage"] is string successMsg)
  {
    <div class="alert alert-success alert-dismissible fade show" role="alert" data-reveal>
      &#9989; @successMsg
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  }

  <!-- Stats -->
  <div class="stats-grid" data-reveal>
    <div class="stat-card">
      <div class="stat-value">@Model.Count</div>
<div class="stat-label">Toplam Mesaj</div>
  </div>
    <div class="stat-card">
      <div class="stat-value">@unreadCount</div>
      <div class="stat-label">Okunmamýþ</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">@unrepliedCount</div>
      <div class="stat-label">Yanýtlanmamýþ</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">@(Model.Count - unrepliedCount)</div>
      <div class="stat-label">Yanýtlanmýþ</div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card mb-4" data-reveal>
    <div class="card-body">
      <h5 class="card-title fw-bold mb-4">&#128269; Filtrele</h5>
 <div class="filter-chips-container">
        <div class="d-flex gap-2 flex-wrap">
 <button class="filter-chip active" data-filter="all">
            &#128466; Tümü <span class="badge">@Model.Count</span>
 </button>
     <button class="filter-chip" data-filter="unread">
      &#128231; Okunmamýþ <span class="badge">@unreadCount</span>
   </button>
          <button class="filter-chip" data-filter="read">
        &#128238; Okunmuþ <span class="badge">@(Model.Count - unreadCount)</span>
      </button>
   <button class="filter-chip" data-filter="unreplied">
        &#128276; Yanýtlanmamýþ <span class="badge">@unrepliedCount</span>
    </button>
    <button class="filter-chip" data-filter="replied">
       &#9989; Yanýtlanmýþ <span class="badge">@(Model.Count - unrepliedCount)</span>
     </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages List -->
  @if (!Model.Any())
  {
    <div class="card" data-reveal>
<div class="card-body">
   <div class="empty-state">
          <div class="empty-state-icon">&#128237;</div>
          <h3 class="empty-state-title">Henüz Mesaj Yok</h3>
          <p class="empty-state-text">Henüz hiç mesaj gelmemiþ.</p>
    </div>
      </div>
    </div>
  }
  else
  {
    <div id="messagesList">
      @foreach (var message in Model)
      {
        <div class="message-item" 
       data-read="@(message.IsRead ? "true" : "false")"
   data-replied="@(message.IsReplied ? "true" : "false")"
       data-reveal>
          <div class="message-card @(message.IsRead ? "" : "unread")">
        <div class="message-header">
        <div class="flex-grow-1">
        <h5 class="message-title">
   @message.Subject
         @if (!message.IsRead)
 {
<span class="badge-custom badge-unread">
  &#11088; Yeni
      </span>
    }
     </h5>
     <div class="message-sender-info">
           <span class="sender-item">
    &#128100; @message.Name
        </span>
        <span class="sender-item">
              &#128231; <a href="mailto:@message.Email">@message.Email</a>
           </span>
        <span class="sender-item">
  &#128241; <a href="tel:@message.Phone">@message.Phone</a>
  </span>
           </div>
   </div>
              <div>
    <span class="badge-custom @(message.IsReplied ? "badge-replied" : "badge-unreplied")">
      @if (message.IsReplied)
     {
        <text>&#9989; Yanýtlandý</text>
     }
             else
           {
          <text>&#9200; Bekliyor</text>
  }
  </span>
      </div>
            </div>

    <div class="message-content">
   <p>@(message.Message.Length > 200 ? message.Message.Substring(0, 200) + "..." : message.Message)</p>
  </div>

            <div class="message-meta">
              <span class="date-badge">
                &#128197; @message.CreatedAtUtc.ToString("dd.MM.yyyy HH:mm")
              </span>
           @if (message.ReadAt.HasValue)
       {
     <span class="date-badge">
                &#128065; Okundu: @message.ReadAt.Value.ToString("dd.MM.yyyy HH:mm")
 </span>
      }
        </div>

 <div class="message-actions">
          <a href="@Url.Action("Details", new { id = message.Id })" class="btn-action btn-action-primary">
     &#128196; Detay Görüntüle
    </a>
<form asp-action="ToggleRead" method="post" class="d-inline">
            @Html.AntiForgeryToken()
     <input type="hidden" name="id" value="@message.Id" />
       <button type="submit" class="btn-action btn-action-secondary">
             @if (message.IsRead)
    {
         <text>&#128683; Okunmadý Ýþaretle</text>
      }
    else
   {
    <text>&#9989; Okundu Ýþaretle</text>
      }
  </button>
         </form>
    </div>
        </div>
        </div>
   }
    </div>
  }
</div>

@section Scripts {
<script>
// Reveal animation
  const reveals=[...document.querySelectorAll('[data-reveal]')];
  if('IntersectionObserver' in window){
    const io=new IntersectionObserver((entries)=>{
      entries.forEach(en=>{ 
 if(en.isIntersecting){ 
   setTimeout(()=>en.target.classList.add('in'), 100); 
  io.unobserve(en.target); 
        } 
      });
    },{threshold:.1, rootMargin:'0px 0px -50px 0px'});
    reveals.forEach(e=>io.observe(e));
  } else {
    reveals.forEach(e=>e.classList.add('in'));
  }

  // Filter functionality
  (function(){
    const chips = document.querySelectorAll('.filter-chip');
    const items = document.querySelectorAll('.message-item');
    
    chips.forEach(chip => {
      chip.addEventListener('click', function() {
        // Update active chip
        chips.forEach(c => c.classList.remove('active'));
   this.classList.add('active');
        
        const filter = this.dataset.filter;
   
        items.forEach(item => {
          const isRead = item.dataset.read === 'true';
       const isReplied = item.dataset.replied === 'true';
          
  let show = true;
          
   if (filter === 'unread') {
          show = !isRead;
        } else if (filter === 'read') {
      show = isRead;
    } else if (filter === 'unreplied') {
            show = !isReplied;
          } else if (filter === 'replied') {
        show = isReplied;
 }
 
          item.style.display = show ? '' : 'none';
     });
      });
    });
  })();
</script>
}
