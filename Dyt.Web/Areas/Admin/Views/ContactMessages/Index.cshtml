@model List<Dyt.Data.Entities.Content.ContactMessage>
@{
    ViewData["Title"] = "Ýletiþim Mesajlarý";
    var unreadCount = Model.Count(m => !m.IsRead);
    var unrepliedCount = Model.Count(m => !m.IsReplied);
}

<style>
  .message-card {
 border-left: 4px solid #e0e0e0;
        transition: all 0.3s ease;
        background: #fff;
    }
    .message-card:hover {
 box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateX(2px);
    }
 .message-card.unread {
     border-left-color: #4CAF50;
        background: rgba(76,175,80,0.05);
    }
    .badge-unread {
        background: linear-gradient(135deg, #4CAF50, #81C784);
      color: white;
    }
    .badge-replied {
 background: linear-gradient(135deg, #2196F3, #64B5F6);
        color: white;
 }
    .badge-unreplied {
        background: linear-gradient(135deg, #FF9800, #FFB74D);
        color: white;
    }
    .stats-card {
        border-radius: 12px;
        padding: 16px;
 background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(255,152,0,0.08));
        border: 2px solid rgba(76,175,80,0.2);
    }
    .filter-chip {
  display: inline-flex;
  align-items: center;
 gap: 8px;
   padding: 8px 16px;
  border-radius: 999px;
   border: 1px solid rgba(76,175,80,0.3);
    background: rgba(76,175,80,0.08);
     cursor: pointer;
 font-weight: 600;
     color: #4CAF50;
    transition: all 0.3s ease;
    }
    .filter-chip:hover, .filter-chip.active {
   background: linear-gradient(135deg, #4CAF50, #81C784);
        border-color: #4CAF50;
  color: #fff;
    }
  .filter-chip svg {
 width: 16px;
    height: 16px;
    fill: currentColor;
  }
  .badge svg {
    width: 14px;
    height: 14px;
    fill: currentColor;
    vertical-align: middle;
  margin-right: 4px;
  }
</style>

<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
 <div>
   <h2 class="mb-1">
     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-mailbox d-inline-block" viewBox="0 0 16 16" style="vertical-align:middle;margin-right:8px;">
       <path d="M4 4a3 3 0 0 0-3 3v6h6V7a3 3 0 0 0-3-3m0-1h8a4 4 0 0 1 4 4v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a4 4 0 0 1 4-4m2.646 1A4 4 0 0 1 8 7v6h7V7a3 3 0 0 0-3-3z"/>
     <path d="M11.793 8.5H9v-1h5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.354-.146zM5 7c0 .552-.448 0-1 0s-1 .552-1 0a1 1 0 0 1 2 0"/>
     </svg>
     Ýletiþim Mesajlarý
   </h2>
   <p class="text-muted mb-0">Siteden gelen mesajlarý görüntüleyin ve yönetin</p>
        </div>
 <div class="d-flex gap-2">
   <div class="stats-card">
    <strong>@unreadCount</strong> okunmamýþ
   </div>
      <div class="stats-card">
       <strong>@unrepliedCount</strong> yanýtlanmamýþ
      </div>
        </div>
    </div>

    @if (TempData["SuccessMessage"] is string successMsg)
    {
     <div class="alert alert-success alert-dismissible fade show">
   @successMsg
 <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    }

 <!-- Filtreler -->
 <div class="card mb-4">
     <div class="card-body">
<div class="d-flex align-items-center gap-2 flex-wrap">
        <span class="fw-semibold me-2">Filtre:</span>
    <button class="filter-chip active" data-filter="all">
       <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list-stars" viewBox="0 0 16 16">
         <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5"/>
         <path d="M2.242 2.194a.27.27 0 0 1 .516 0l.162.53c.035.115.14.194.258.194h.551c.259 0 .37.333.164.493l-.468.363a.28.28 0 0 0-.098.306l.162.53c.076.248-.213.456-.423.303l-.468-.363a.28.28 0 0 0-.328 0l-.468.363c-.21.153-.5-.055-.423-.303l.162-.53a.28.28 0 0 0-.098-.306l-.468-.363c-.206-.16-.095-.493.164-.493h.551a.27.27 0 0 0 .258-.194z"/>
       </svg>
       Tümü <span class="badge bg-light text-dark ms-1">@Model.Count</span>
     </button>
 <button class="filter-chip" data-filter="unread">
     <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
         <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/>
       </svg>
        Okunmamýþ <span class="badge bg-light text-dark ms-1">@unreadCount</span>
     </button>
      <button class="filter-chip" data-filter="read">
       <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-envelope-open" viewBox="0 0 16 16">
         <path d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.817l5.75 3.45L8 8.917l1.25.75L15 6.217V5.4a1 1 0 0 0-.53-.882zM15 7.383l-4.778 2.867L15 13.117zm-.035 6.88L8 10.082l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738ZM1 13.116l4.778-2.867L1 7.383v5.734ZM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765z"/>
       </svg>
     Okunmuþ <span class="badge bg-light text-dark ms-1">@(Model.Count - unreadCount)</span>
     </button>
     <button class="filter-chip" data-filter="unreplied">
   <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
       <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"/>
     </svg>
     Yanýtlanmamýþ <span class="badge bg-light text-dark ms-1">@unrepliedCount</span>
       </button>
    <button class="filter-chip" data-filter="replied">
       <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
         <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
         <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
       </svg>
    Yanýtlanmýþ <span class="badge bg-light text-dark ms-1">@(Model.Count - unrepliedCount)</span>
   </button>
      </div>
    </div>
  </div>

    @if (!Model.Any())
    {
 <div class="alert alert-info">
   <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle d-inline-block" viewBox="0 0 16 16" style="vertical-align:middle;margin-right:6px;">
     <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
     <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533z"/>
 <path d="M9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
   </svg>
   Henüz hiç mesaj gelmemiþ.
      </div>
    }
    else
    {
      <div class="row g-3" id="messagesList">
   @foreach (var message in Model)
{
       <div class="col-12 message-item" 
  data-read="@(message.IsRead ? "true" : "false")"
           data-replied="@(message.IsReplied ? "true" : "false")">
    <div class="card message-card @(message.IsRead ? "" : "unread")">
       <div class="card-body">
       <div class="d-flex justify-content-between align-items-start mb-2">
       <div class="flex-grow-1">
     <h5 class="mb-1">
          <a href="@Url.Action("Details", new { id = message.Id })" class="text-decoration-none">
@message.Subject
   </a>
     @if (!message.IsRead)
    {
              <span class="badge badge-unread ms-2">
       <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
           <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
          </svg>
 Yeni
          </span>
}
    </h5>
 <div class="text-muted small mb-2">
   <strong>@message.Name</strong> • 
 <a href="mailto:@message.Email">@message.Email</a> • 
     <a href="tel:@message.Phone">@message.Phone</a>
       </div>
 <p class="mb-2 text-muted">
@(message.Message.Length > 150 ? message.Message.Substring(0, 150) + "..." : message.Message)
   </p>
   <div class="d-flex gap-2 align-items-center flex-wrap">
     <span class="badge @(message.IsReplied ? "badge-replied" : "badge-unreplied")">
       @if (message.IsReplied)
 {
       <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-check-lg" viewBox="0 0 16 16">
           <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
         </svg>
 <text>Yanýtlandý</text>
       }
       else
       {
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
           <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
         <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>
     </svg>
  <text>Yanýtlanmamýþ</text>
       }
        </span>
    <span class="text-muted small">
         <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-calendar3 d-inline-block" viewBox="0 0 16 16" style="vertical-align:middle;margin-right:4px;">
   <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2M1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857z"/>
       <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
         </svg>
         @message.CreatedAtUtc.ToString("dd.MM.yyyy HH:mm")
  </span>
      @if (message.ReadAt.HasValue)
         {
   <span class="text-muted small">
       <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye d-inline-block" viewBox="0 0 16 16" style="vertical-align:middle;margin-right:4px;">
     <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
     <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
  </svg>
    @message.ReadAt.Value.ToString("dd.MM.yyyy HH:mm")
 </span>
       }
     </div>
</div>
       <div class="d-flex flex-column gap-2">
 <a href="@Url.Action("Details", new { id = message.Id })" class="btn btn-sm btn-primary">
    Detay
       </a>
   <form asp-action="ToggleRead" method="post" class="d-inline">
     @Html.AntiForgeryToken()
    <input type="hidden" name="id" value="@message.Id" />
      <button type="submit" class="btn btn-sm btn-outline-secondary w-100">
   @(message.IsRead ? "Okunmadý" : "Okundu")
       </button>
     </form>
 </div>
 </div>
       </div>
       </div>
        </div>
            }
        </div>
    }
</div>

@section Scripts {
<script>
    (function(){
        const chips = document.querySelectorAll('.filter-chip');
const items = document.querySelectorAll('.message-item');
        
      chips.forEach(chip => {
   chip.addEventListener('click', function() {
     // Aktif chip'i güncelle
       chips.forEach(c => c.classList.remove('active'));
        this.classList.add('active');
    
          const filter = this.dataset.filter;
  
                items.forEach(item => {
   const isRead = item.dataset.read === 'true';
           const isReplied = item.dataset.replied === 'true';
   
       let show = true;
    
   if (filter === 'unread') {
         show = !isRead;
     } else if (filter === 'read') {
        show = isRead;
      } else if (filter === 'unreplied') {
show = !isReplied;
   } else if (filter === 'replied') {
     show = isReplied;
  }
          
           item.style.display = show ? '' : 'none';
     });
     });
        });
    })();
</script>
}
